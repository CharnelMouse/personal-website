---
title: "Using autodb"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using autodb}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>
<script src="{{< blogdown/postref >}}index_files/htmlwidgets/htmlwidgets.js"></script>
<script src="{{< blogdown/postref >}}index_files/viz/viz.js"></script>
<link href="{{< blogdown/postref >}}index_files/DiagrammeR-styles/styles.css" rel="stylesheet" />
<script src="{{< blogdown/postref >}}index_files/grViz-binding/grViz.js"></script>


<pre class="r"><code>library(autodb)
#&gt; 
#&gt; Attaching package: &#39;autodb&#39;
#&gt; The following object is masked from &#39;package:stats&#39;:
#&gt; 
#&gt;     decompose</code></pre>
<div id="terminology" class="section level1">
<h1>Terminology</h1>
<p>To avoid confusion, this vignette is consistent with terminology: a <em>database</em> consists of <em>relations</em>, which have <em>records</em> with the same <em>attributes</em>. This is in line with terms used in the relational model; in Statistics, where we would talk about tables, which have rows with values for the same variables, with a column for each variable. For the original data set, which is a flat table, we refer to a <em>data frame</em> instead, which also consists of records with attributes.</p>
</div>
<div id="motivation" class="section level1">
<h1>Motivation</h1>
<p><code>autodb</code> is described in the DESCRIPTION file in the following way:</p>
<blockquote>
<p>Automatic normalisation of a data frame to third normal form, with the intention of easing the process of data cleaning. (Usage to design your actual database for you is not advised.)”</p>
</blockquote>
<p>Let us begin there.</p>
<div id="for-data-cleaning" class="section level2">
<h2>For data cleaning</h2>
<p>Database normalisation works on the principle that our data should only express a piece of information in a single place. This is done to reduce the chance that a modification will accidentally change or remove other pieces of information.</p>
<p>Data cleaning works on the principle that we remove duplicate observations and structural errors, and have a clear understanding of any associations between different observations, or parts of observations. This is done to ensure a high quality for the data used in analysis, but I have found that it is equally important for making sure that I understand the domain I am hoping to model.</p>
<p>Normalisation is helpful for both of these areas. I usually use the original, flat, “tidy” data for the analysis itself. However, for checking the data’s consistency, and for using the data to learn about the domain, normalised data is often helpful, whether it’s used for the analysis or not.</p>
<p>I usually do data checking under the following conditions:</p>
<ul>
<li>No need to store the data in normalised form. My own work normally consists of one-off analyses, where I won’t see the data again once I’ve finished the work. For more permanent data, it would be better to store the data in a database designed to hold it, if you’re able to.</li>
<li>Limited documentation. In my own work, I am lucky if I am given a key or a data dictionary for the data set at all. When I am, it usually proves to be wrong somehow. This makes it even more important to do data checking, not just for looking for errors, but also as an exercise in understanding the problem domain before starting to model it.</li>
<li>Data that fits in local memory. This process could be done in batches or using a streaming algorithm, but this is a more advanced case.</li>
</ul>
<p>It’s in this context that I would usually have to do the normalisation by hand, and I would like to have a tool that does it semi-automatically. This package is intended to be that tool, using a minimal amount of additional libraries.</p>
</div>
<div id="not-for-database-design" class="section level2">
<h2>Not for database design</h2>
<p>Good database design is a hard and involved process, which requires a strong grasp on the domain that the database will hold information on. Please don’t try to use this package to do it on autopilot. In particular, the conditions described above mean we do things differently to good practice for normalised relational databases:</p>
<ul>
<li>We need to handle constant attributes, that have the same value in every record. In a real database, we would probably expect these to not stay constant when more data is added, and would know which relation to place it in. In one-off data checking, there isn’t more data coming, so we need to handle these attributes in an automatic way by placing them in a “constants” relation with an empty key, which database designers would probably frown at.</li>
<li>We don’t care about database design principles concerned with avoiding errors under deletion, modification, and so on, because the data won’t change. This means that we don’t care about introducing artificial keys, unless we think it would make data modelling more convenient. Similarly, we don’t care about having single-attribute reference relations, which are used to make sure other relations only assign legal values to that relation’s attribute.</li>
<li>We have no “derived relations”, also known as “views”, which are additional relations created from the others for lookup convenience. We expect to be using the data frame for modelling, rather than the database, so such lookups aren’t commonly necessary, and are left to the discretion of the user to do manually with base R’s <code>merge</code> function.</li>
</ul>
</div>
<div id="to-third-normal-form" class="section level2">
<h2>To third normal form</h2>
<p><code>autodb</code> gets a given data.frame to third normal form: every attribute depends on the whole key(s), and non-key attributes depend on nothing but the key(s). This was chosen because there is an existing algorithm, Bernstein’s synthesis, for normalising to third normal form, and because it’s the highest normal form that is attainable with arbitrary original data frames. There is an additional enhancement available as an option: see the section on avoidable attributes for more details.</p>
</div>
</div>
<div id="simple-examples" class="section level1">
<h1>Simple examples</h1>
<p>For most of these simple examples, we use the <code>ChickWeight</code> dataset, included with base R.</p>
<pre class="r"><code>summary(ChickWeight)
#&gt;      weight           Time           Chick     Diet   
#&gt;  Min.   : 35.0   Min.   : 0.00   13     : 12   1:220  
#&gt;  1st Qu.: 63.0   1st Qu.: 4.00   9      : 12   2:120  
#&gt;  Median :103.0   Median :10.00   20     : 12   3:120  
#&gt;  Mean   :121.8   Mean   :10.72   10     : 12   4:118  
#&gt;  3rd Qu.:163.8   3rd Qu.:16.00   17     : 12          
#&gt;  Max.   :373.0   Max.   :21.00   19     : 12          
#&gt;                                  (Other):506</code></pre>
<div id="normalisation-with-autodb" class="section level2">
<h2>Normalisation with <code>autodb</code></h2>
<p>The simplest way to do normalisation is with the <code>autodb</code> function:</p>
<pre class="r"><code>db &lt;- autodb(ChickWeight, accuracy = 1, name = &quot;Chick Weights&quot;)</code></pre>
<p>The <code>accuracy</code> argument expects a number between zero and one, determining what proportion of a data frame’s records need to satisfy a given dependency for the algorithm to consider it valid. Setting <code>accuracy</code> to one, as done here, limits us to exact dependencies. We’ll look at other values later, in the section on approximate dependencies.</p>
<pre class="r"><code>db
#&gt; database Chick Weights with 2 relations
#&gt; relation Time_Chick: Time, Chick, weight; 578 records
#&gt;   key 1: Time, Chick
#&gt; relation Chick: Chick, Diet; 50 records
#&gt;   key 1: Chick
#&gt; relationships:
#&gt; Time_Chick.Chick -&gt; Chick.Chick</code></pre>
</div>
<div id="plots" class="section level2">
<h2>Plots</h2>
<p>There is no plotting method within the <code>autodb</code> package itself. Instead, there are functions to write normalised objects as inputs to the Graphviz visualisation software, using the DOT language.</p>
<p>The generic function to do this is <code>gv</code>, which calls the <code>gv.database</code> method on our database, <code>db</code>:</p>
<pre class="r"><code>db_text &lt;- gv(db)
cat(db_text)
#&gt; digraph chick_weights {
#&gt;   rankdir = &quot;LR&quot;
#&gt;   node [shape=plaintext];
#&gt; 
#&gt;   time_chick [label = &lt;
#&gt;     &lt;TABLE BORDER=&quot;0&quot; CELLBORDER=&quot;1&quot; CELLSPACING=&quot;0&quot; CELLPADDING=&quot;4&quot;&gt;
#&gt;     &lt;TR&gt;&lt;TD COLSPAN=&quot;3&quot;&gt;Time_Chick (578 records)&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;TR&gt;&lt;TD PORT=&quot;TO_time&quot;&gt;Time&lt;/TD&gt;&lt;TD BGCOLOR=&quot;black&quot;&gt;&lt;/TD&gt;&lt;TD PORT=&quot;FROM_time&quot;&gt;numeric&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;TR&gt;&lt;TD PORT=&quot;TO_chick&quot;&gt;Chick&lt;/TD&gt;&lt;TD BGCOLOR=&quot;black&quot;&gt;&lt;/TD&gt;&lt;TD PORT=&quot;FROM_chick&quot;&gt;ordered&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;TR&gt;&lt;TD PORT=&quot;TO_weight&quot;&gt;weight&lt;/TD&gt;&lt;TD&gt;&lt;/TD&gt;&lt;TD PORT=&quot;FROM_weight&quot;&gt;numeric&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;/TABLE&gt;&gt;];
#&gt;   chick [label = &lt;
#&gt;     &lt;TABLE BORDER=&quot;0&quot; CELLBORDER=&quot;1&quot; CELLSPACING=&quot;0&quot; CELLPADDING=&quot;4&quot;&gt;
#&gt;     &lt;TR&gt;&lt;TD COLSPAN=&quot;3&quot;&gt;Chick (50 records)&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;TR&gt;&lt;TD PORT=&quot;TO_chick&quot;&gt;Chick&lt;/TD&gt;&lt;TD BGCOLOR=&quot;black&quot;&gt;&lt;/TD&gt;&lt;TD PORT=&quot;FROM_chick&quot;&gt;ordered&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;TR&gt;&lt;TD PORT=&quot;TO_diet&quot;&gt;Diet&lt;/TD&gt;&lt;TD&gt;&lt;/TD&gt;&lt;TD PORT=&quot;FROM_diet&quot;&gt;factor&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;/TABLE&gt;&gt;];
#&gt; 
#&gt;   time_chick:FROM_chick -&gt; chick:TO_chick;
#&gt; }</code></pre>
<p>This can be saved to a file for passing to Graphviz elsewhere, or can be passed into <code>grViz</code> in the <code>DiagrammeR</code> package:</p>
<pre class="r"><code>DiagrammeR::grViz(db_text)</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"diagram":"digraph chick_weights {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  time_chick [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Time_Chick (578 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_time\">Time<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_time\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_chick\">ordered<\/TD><\/TR>\n    <TR><TD PORT=\"TO_weight\">weight<\/TD><TD><\/TD><TD PORT=\"FROM_weight\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n  chick [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Chick (50 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_chick\">ordered<\/TD><\/TR>\n    <TR><TD PORT=\"TO_diet\">Diet<\/TD><TD><\/TD><TD PORT=\"FROM_diet\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n\n  time_chick:FROM_chick -> chick:TO_chick;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>Each relation is represented as a box, with the top row giving the relation name and the number of records, and the other rows detailing the attributes. In the middle is a grid of cells: each column of cells represents a (candidate) key for the relation, where attributes in that key have their cell filled in black.</p>
<p>We can see that <code>ChickWeight</code> was split into two relations, with a weight for each unique combination of Chick number and time, and the Chick number by itself determining the diet. We can also see the number of records in each relation, and the classes of the attributes in those relations.</p>
<p><code>gv</code> also has methods for <code>data.frame</code>, and for <code>database_schema</code>, which is introduced later.</p>
</div>
<div id="finding-functional-dependencies-with-dfd" class="section level2">
<h2>Finding functional dependencies with DFD</h2>
<p>Having looked at the final result first, we now look at the individual steps. The first step is to find the (non-trivial and minimal) dependencies present in the given data.frame. There are various ways to do this; the package uses DFD, a depth-first search algorithm. We run this using the <code>dfd</code> function, setting <code>progress</code> to <code>TRUE</code> to see the steps taken:</p>
<pre class="r"><code>deps &lt;- dfd(ChickWeight, 1, progress = TRUE)
#&gt; simplifying data types
#&gt; constructing powerset
#&gt; dependent weight
#&gt; determinants available, starting search
#&gt; dependent Time
#&gt; determinants available, starting search
#&gt; dependent Chick
#&gt; determinants available, starting search
#&gt; dependent Diet
#&gt; determinants available, starting search
#&gt; DFD complete
deps
#&gt; $dependencies
#&gt; $dependencies$weight
#&gt; $dependencies$weight[[1]]
#&gt; [1] &quot;Time&quot;  &quot;Chick&quot;
#&gt; 
#&gt; 
#&gt; $dependencies$Time
#&gt; list()
#&gt; 
#&gt; $dependencies$Chick
#&gt; list()
#&gt; 
#&gt; $dependencies$Diet
#&gt; $dependencies$Diet[[1]]
#&gt; [1] &quot;Chick&quot;
#&gt; 
#&gt; 
#&gt; 
#&gt; $attrs
#&gt; [1] &quot;weight&quot; &quot;Time&quot;   &quot;Chick&quot;  &quot;Diet&quot;</code></pre>
<p>After simplifying the data to something quicker to iterate over – specifically, by converting all attributes to have integer values – the algorithm takes each attribute in turn as a possible dependent, and finds sets of the other attributes that determine it.</p>
<p>The result is a list, with two elements: <code>dependencies</code> gives the discovered determinants of each attribute in turn, and <code>attrs</code> gives all the attribute names in their original order.</p>
<p>This is meant to be a reasonably compact, user-readable presentation of the results, for when we’re interested in the determinants for a particular dependent attribute. For use in the later stages of the process, we convert to a different format first, using <code>flatten</code>:</p>
<pre class="r"><code>flat_deps &lt;- flatten(deps)
flat_deps
#&gt; $dependencies
#&gt; $dependencies[[1]]
#&gt; $dependencies[[1]][[1]]
#&gt; [1] &quot;Time&quot;  &quot;Chick&quot;
#&gt; 
#&gt; $dependencies[[1]][[2]]
#&gt; [1] &quot;weight&quot;
#&gt; 
#&gt; 
#&gt; $dependencies[[2]]
#&gt; $dependencies[[2]][[1]]
#&gt; [1] &quot;Chick&quot;
#&gt; 
#&gt; $dependencies[[2]][[2]]
#&gt; [1] &quot;Diet&quot;
#&gt; 
#&gt; 
#&gt; 
#&gt; $attrs
#&gt; [1] &quot;weight&quot; &quot;Time&quot;   &quot;Chick&quot;  &quot;Diet&quot;</code></pre>
<p>Dependencies are now separate entries, rather than being grouped by dependent.</p>
</div>
<div id="normalisation" class="section level2">
<h2>Normalisation</h2>
<p>Now that we have a list of discovered dependencies, we can construct a database schema, where the relation schemas are normalised to third normal form. This is done using a version of Bernstein’s synthesis.</p>
<pre class="r"><code>schema &lt;- normalise(flat_deps)
schema
#&gt; database schema with 2 relation schemas
#&gt; schema 1: Time, Chick, weight
#&gt;   key 1: Time, Chick
#&gt; schema 2: Chick, Diet
#&gt;   key 1: Chick
#&gt; no relationships</code></pre>
<p>Like the database before, we can also plot this database schema:</p>
<pre class="r"><code>schema_text &lt;- gv(schema)
cat(schema_text)
#&gt; digraph {
#&gt;   rankdir = &quot;LR&quot;
#&gt;   node [shape=plaintext];
#&gt; 
#&gt;   time_chick [label = &lt;
#&gt;     &lt;TABLE BORDER=&quot;0&quot; CELLBORDER=&quot;1&quot; CELLSPACING=&quot;0&quot; CELLPADDING=&quot;4&quot;&gt;
#&gt;     &lt;TR&gt;&lt;TD COLSPAN=&quot;2&quot;&gt;Time_Chick&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;TR&gt;&lt;TD PORT=&quot;TO_time&quot;&gt;Time&lt;/TD&gt;&lt;TD PORT =&quot;FROM_time&quot; BGCOLOR=&quot;black&quot;&gt;&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;TR&gt;&lt;TD PORT=&quot;TO_chick&quot;&gt;Chick&lt;/TD&gt;&lt;TD PORT =&quot;FROM_chick&quot; BGCOLOR=&quot;black&quot;&gt;&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;TR&gt;&lt;TD PORT=&quot;TO_weight&quot;&gt;weight&lt;/TD&gt;&lt;TD PORT =&quot;FROM_weight&quot;&gt;&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;/TABLE&gt;&gt;];
#&gt;   chick [label = &lt;
#&gt;     &lt;TABLE BORDER=&quot;0&quot; CELLBORDER=&quot;1&quot; CELLSPACING=&quot;0&quot; CELLPADDING=&quot;4&quot;&gt;
#&gt;     &lt;TR&gt;&lt;TD COLSPAN=&quot;2&quot;&gt;Chick&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;TR&gt;&lt;TD PORT=&quot;TO_chick&quot;&gt;Chick&lt;/TD&gt;&lt;TD PORT =&quot;FROM_chick&quot; BGCOLOR=&quot;black&quot;&gt;&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;TR&gt;&lt;TD PORT=&quot;TO_diet&quot;&gt;Diet&lt;/TD&gt;&lt;TD PORT =&quot;FROM_diet&quot;&gt;&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;/TABLE&gt;&gt;];
#&gt; 
#&gt; 
#&gt; }
DiagrammeR::grViz(schema_text)</code></pre>
<div id="htmlwidget-2" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  time_chick [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">Time_Chick<\/TD><\/TR>\n    <TR><TD PORT=\"TO_time\">Time<\/TD><TD PORT =\"FROM_time\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD PORT =\"FROM_chick\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_weight\">weight<\/TD><TD PORT =\"FROM_weight\"><\/TD><\/TR>\n    <\/TABLE>>];\n  chick [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">Chick<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD PORT =\"FROM_chick\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_diet\">Diet<\/TD><TD PORT =\"FROM_diet\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>This is similar to the database plot given before, but there is some information not present, that requires the data frame itself. Namely, we have no class information about the attributes, and no record counts for the individual relation schemas. Additionally, at this point we have no connections between the relation schemas, since Bernstein’s synthesis doesn’t supply information about foreign key references. We could use this database schema to build a database, but we’d rather add the foreign key references first.</p>
</div>
<div id="tuning-detection-and-normalisation" class="section level2">
<h2>Tuning detection and normalisation</h2>
<p>Let’s look at a different dataset for a moment, to look at some cases where we don’t want to use the dependencies as given. We’ll use the Titanic data set, also provided with base R. This data is in array form, so we first convert it to data frame form:</p>
<pre class="r"><code>as.data.frame(Titanic)
#&gt;    Class    Sex   Age Survived Freq
#&gt; 1    1st   Male Child       No    0
#&gt; 2    2nd   Male Child       No    0
#&gt; 3    3rd   Male Child       No   35
#&gt; 4   Crew   Male Child       No    0
#&gt; 5    1st Female Child       No    0
#&gt; 6    2nd Female Child       No    0
#&gt; 7    3rd Female Child       No   17
#&gt; 8   Crew Female Child       No    0
#&gt; 9    1st   Male Adult       No  118
#&gt; 10   2nd   Male Adult       No  154
#&gt; 11   3rd   Male Adult       No  387
#&gt; 12  Crew   Male Adult       No  670
#&gt; 13   1st Female Adult       No    4
#&gt; 14   2nd Female Adult       No   13
#&gt; 15   3rd Female Adult       No   89
#&gt; 16  Crew Female Adult       No    3
#&gt; 17   1st   Male Child      Yes    5
#&gt; 18   2nd   Male Child      Yes   11
#&gt; 19   3rd   Male Child      Yes   13
#&gt; 20  Crew   Male Child      Yes    0
#&gt; 21   1st Female Child      Yes    1
#&gt; 22   2nd Female Child      Yes   13
#&gt; 23   3rd Female Child      Yes   14
#&gt; 24  Crew Female Child      Yes    0
#&gt; 25   1st   Male Adult      Yes   57
#&gt; 26   2nd   Male Adult      Yes   14
#&gt; 27   3rd   Male Adult      Yes   75
#&gt; 28  Crew   Male Adult      Yes  192
#&gt; 29   1st Female Adult      Yes  140
#&gt; 30   2nd Female Adult      Yes   80
#&gt; 31   3rd Female Adult      Yes   76
#&gt; 32  Crew Female Adult      Yes   20</code></pre>
<p>This is a simple set of data, with a single count observation, <code>Freq</code>, for each combination of the four determining attributes. In other words, the relation is already normalised, so we only expect one relation in the normalised database.</p>
<p>If we use <code>autodb</code> again, we get the following database:</p>
<pre class="r"><code>DiagrammeR::grViz(gv(autodb(as.data.frame(Titanic), 1)))</code></pre>
<div id="htmlwidget-3" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  sex_survived_freq [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Sex_Survived_Freq (28 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sex\">Sex<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_sex\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_survived\">Survived<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_survived\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_freq\">Freq<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_freq\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_age\">Age<\/TD><TD><\/TD><TD PORT=\"FROM_age\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  class_survived_freq [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Class_Survived_Freq (28 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_class\">Class<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_class\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_survived\">Survived<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_survived\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_freq\">Freq<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_freq\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_age\">Age<\/TD><TD><\/TD><TD PORT=\"FROM_age\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  class_sex_age_survived [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Class_Sex_Age_Survived (32 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_class\">Class<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_class\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sex\">Sex<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_sex\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_age\">Age<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_age\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_survived\">Survived<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_survived\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_freq\">Freq<\/TD><TD><\/TD><TD PORT=\"FROM_freq\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n\n  class_sex_age_survived:FROM_sex -> sex_survived_freq:TO_sex;\n  class_sex_age_survived:FROM_survived -> sex_survived_freq:TO_survived;\n  class_sex_age_survived:FROM_freq -> sex_survived_freq:TO_freq;\n  class_sex_age_survived:FROM_class -> class_survived_freq:TO_class;\n  class_sex_age_survived:FROM_survived -> class_survived_freq:TO_survived;\n  class_sex_age_survived:FROM_freq -> class_survived_freq:TO_freq;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>Oops! The DFD algorithm found some functional dependencies where the count could be used to determine another attribute. These are clearly spurious: frequency count can’t causally determine age, for example. However, the algorithm still finds these dependencies, because the counts are unique often enough to make these dependencies hold in the given data.</p>
<p>There are two approaches we can take to eliminate these spurious dependencies: not letting them be detected in the first place, and removing them before using <code>cross_reference</code>.</p>
<p>To stop them being detected, we can put constraints on what is discovered by <code>dfd</code>: we can ask for certain attributes to not be considered as determinants, or we can exclude attributes that inherit from certain classes. In this example, we could exclude <code>Freq</code> from being considered:</p>
<pre class="r"><code>titanic_deps_freqonly &lt;- dfd(as.data.frame(Titanic), 1, exclude = &quot;Freq&quot;)
titanic_deps_freqonly
#&gt; $dependencies
#&gt; $dependencies$Class
#&gt; list()
#&gt; 
#&gt; $dependencies$Sex
#&gt; list()
#&gt; 
#&gt; $dependencies$Age
#&gt; list()
#&gt; 
#&gt; $dependencies$Survived
#&gt; list()
#&gt; 
#&gt; $dependencies$Freq
#&gt; $dependencies$Freq[[1]]
#&gt; [1] &quot;Class&quot;    &quot;Sex&quot;      &quot;Age&quot;      &quot;Survived&quot;
#&gt; 
#&gt; 
#&gt; 
#&gt; $attrs
#&gt; [1] &quot;Class&quot;    &quot;Sex&quot;      &quot;Age&quot;      &quot;Survived&quot; &quot;Freq&quot;</code></pre>
<p>Alternatively, we could exclude all attributes that inherit from “numeric”:</p>
<pre class="r"><code>identical(titanic_deps_freqonly, dfd(as.data.frame(Titanic), 1, exclude_class = &quot;numeric&quot;))
#&gt; [1] TRUE</code></pre>
<p>These can both be used as arguments to <code>autodb</code> too:</p>
<pre class="r"><code>DiagrammeR::grViz(gv(autodb(as.data.frame(Titanic), 1, exclude = &quot;Freq&quot;)))</code></pre>
<div id="htmlwidget-4" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  class_sex_age_survived [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Class_Sex_Age_Survived (32 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_class\">Class<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_class\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sex\">Sex<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_sex\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_age\">Age<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_age\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_survived\">Survived<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_survived\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_freq\">Freq<\/TD><TD><\/TD><TD PORT=\"FROM_freq\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n\n\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>Generally, excluding numeric attributes as determinants is often useful, because we expect non-integer numbers to be a measurement, not part of a primary key.</p>
<p>Alternatively, we could remove unwanted dependencies before using <code>decompose</code>. Here are the found dependencies, if we don’t exclude anything:</p>
<pre class="r"><code>titanic_deps &lt;- dfd(as.data.frame(Titanic), 1)
titanic_deps
#&gt; $dependencies
#&gt; $dependencies$Class
#&gt; list()
#&gt; 
#&gt; $dependencies$Sex
#&gt; list()
#&gt; 
#&gt; $dependencies$Age
#&gt; $dependencies$Age[[1]]
#&gt; [1] &quot;Sex&quot;      &quot;Survived&quot; &quot;Freq&quot;    
#&gt; 
#&gt; $dependencies$Age[[2]]
#&gt; [1] &quot;Class&quot;    &quot;Survived&quot; &quot;Freq&quot;    
#&gt; 
#&gt; 
#&gt; $dependencies$Survived
#&gt; list()
#&gt; 
#&gt; $dependencies$Freq
#&gt; $dependencies$Freq[[1]]
#&gt; [1] &quot;Class&quot;    &quot;Sex&quot;      &quot;Age&quot;      &quot;Survived&quot;
#&gt; 
#&gt; 
#&gt; 
#&gt; $attrs
#&gt; [1] &quot;Class&quot;    &quot;Sex&quot;      &quot;Age&quot;      &quot;Survived&quot; &quot;Freq&quot;</code></pre>
<p>We could remove the unwanted dependencies, where <code>Age</code> is the dependent, from here:</p>
<pre class="r"><code>titanic_deps_filtered &lt;- titanic_deps
titanic_deps_filtered$dependencies$Age &lt;- list()
identical(titanic_deps_filtered, titanic_deps_freqonly)
#&gt; [1] TRUE</code></pre>
<p>Alternatively, we could remove them from the flattened version, if that’s more convenient:</p>
<pre class="r"><code>flatten(titanic_deps)
#&gt; $dependencies
#&gt; $dependencies[[1]]
#&gt; $dependencies[[1]][[1]]
#&gt; [1] &quot;Sex&quot;      &quot;Survived&quot; &quot;Freq&quot;    
#&gt; 
#&gt; $dependencies[[1]][[2]]
#&gt; [1] &quot;Age&quot;
#&gt; 
#&gt; 
#&gt; $dependencies[[2]]
#&gt; $dependencies[[2]][[1]]
#&gt; [1] &quot;Class&quot;    &quot;Survived&quot; &quot;Freq&quot;    
#&gt; 
#&gt; $dependencies[[2]][[2]]
#&gt; [1] &quot;Age&quot;
#&gt; 
#&gt; 
#&gt; $dependencies[[3]]
#&gt; $dependencies[[3]][[1]]
#&gt; [1] &quot;Class&quot;    &quot;Sex&quot;      &quot;Age&quot;      &quot;Survived&quot;
#&gt; 
#&gt; $dependencies[[3]][[2]]
#&gt; [1] &quot;Freq&quot;
#&gt; 
#&gt; 
#&gt; 
#&gt; $attrs
#&gt; [1] &quot;Class&quot;    &quot;Sex&quot;      &quot;Age&quot;      &quot;Survived&quot; &quot;Freq&quot;
titanic_deps_filtered2 &lt;- flatten(titanic_deps)
titanic_deps_filtered2$dependencies &lt;- Filter(
  function(dep) dep[[2]] == &quot;Freq&quot;, 
  titanic_deps_filtered2$dependencies
)
identical(flatten(titanic_deps_freqonly), titanic_deps_filtered2)
#&gt; [1] TRUE</code></pre>
</div>
<div id="adding-cross-references" class="section level2">
<h2>Adding cross-references</h2>
<p>Getting back to our <code>ChickWeight</code> example, we now have a database schema, consisting of a list of <code>relation</code> schemas. However, we have no information about how these relation schemas are linked to each other. In particular, we have no information about foreign keys, that we would need to join relations back together, to reconstruct the original data frame. We can add this information using <code>cross_reference</code>:</p>
<pre class="r"><code>linked_schema &lt;- cross_reference(schema)
linked_schema
#&gt; database schema with 2 relation schemas
#&gt; schema 1: Time, Chick, weight
#&gt;   key 1: Time, Chick
#&gt; schema 2: Chick, Diet
#&gt;   key 1: Chick
#&gt; relationships:
#&gt; 1.Chick -&gt; 2.Chick</code></pre>
<p>Plotting this updated database schema shows the same relation schemas as before, linked together by foreign key references:</p>
<pre class="r"><code>linked_text &lt;- gv(linked_schema)
cat(linked_text)
#&gt; digraph {
#&gt;   rankdir = &quot;LR&quot;
#&gt;   node [shape=plaintext];
#&gt; 
#&gt;   time_chick [label = &lt;
#&gt;     &lt;TABLE BORDER=&quot;0&quot; CELLBORDER=&quot;1&quot; CELLSPACING=&quot;0&quot; CELLPADDING=&quot;4&quot;&gt;
#&gt;     &lt;TR&gt;&lt;TD COLSPAN=&quot;2&quot;&gt;Time_Chick&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;TR&gt;&lt;TD PORT=&quot;TO_time&quot;&gt;Time&lt;/TD&gt;&lt;TD PORT =&quot;FROM_time&quot; BGCOLOR=&quot;black&quot;&gt;&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;TR&gt;&lt;TD PORT=&quot;TO_chick&quot;&gt;Chick&lt;/TD&gt;&lt;TD PORT =&quot;FROM_chick&quot; BGCOLOR=&quot;black&quot;&gt;&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;TR&gt;&lt;TD PORT=&quot;TO_weight&quot;&gt;weight&lt;/TD&gt;&lt;TD PORT =&quot;FROM_weight&quot;&gt;&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;/TABLE&gt;&gt;];
#&gt;   chick [label = &lt;
#&gt;     &lt;TABLE BORDER=&quot;0&quot; CELLBORDER=&quot;1&quot; CELLSPACING=&quot;0&quot; CELLPADDING=&quot;4&quot;&gt;
#&gt;     &lt;TR&gt;&lt;TD COLSPAN=&quot;2&quot;&gt;Chick&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;TR&gt;&lt;TD PORT=&quot;TO_chick&quot;&gt;Chick&lt;/TD&gt;&lt;TD PORT =&quot;FROM_chick&quot; BGCOLOR=&quot;black&quot;&gt;&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;TR&gt;&lt;TD PORT=&quot;TO_diet&quot;&gt;Diet&lt;/TD&gt;&lt;TD PORT =&quot;FROM_diet&quot;&gt;&lt;/TD&gt;&lt;/TR&gt;
#&gt;     &lt;/TABLE&gt;&gt;];
#&gt; 
#&gt;   time_chick:FROM_chick -&gt; chick:TO_chick;
#&gt; }
DiagrammeR::grViz(linked_text)</code></pre>
<div id="htmlwidget-5" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-5">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  time_chick [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">Time_Chick<\/TD><\/TR>\n    <TR><TD PORT=\"TO_time\">Time<\/TD><TD PORT =\"FROM_time\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD PORT =\"FROM_chick\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_weight\">weight<\/TD><TD PORT =\"FROM_weight\"><\/TD><\/TR>\n    <\/TABLE>>];\n  chick [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">Chick<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD PORT =\"FROM_chick\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_diet\">Diet<\/TD><TD PORT =\"FROM_diet\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  time_chick:FROM_chick -> chick:TO_chick;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="decomposing-the-original-relation" class="section level2">
<h2>Decomposing the original relation</h2>
<p>Finally, once we have our normalised database schema, we can apply it to our original data frame, or a new one with the same structure. This results in a normalised database, as we got from using <code>autodb</code>:</p>
<pre class="r"><code>db2 &lt;- decompose(ChickWeight, linked_schema)
DiagrammeR::grViz(gv(db2, name = &quot;Chick Weights&quot;))</code></pre>
<div id="htmlwidget-6" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-6">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  time_chick [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Time_Chick (578 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_time\">Time<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_time\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_chick\">ordered<\/TD><\/TR>\n    <TR><TD PORT=\"TO_weight\">weight<\/TD><TD><\/TD><TD PORT=\"FROM_weight\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n  chick [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Chick (50 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_chick\">ordered<\/TD><\/TR>\n    <TR><TD PORT=\"TO_diet\">Diet<\/TD><TD><\/TD><TD PORT=\"FROM_diet\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n\n  time_chick:FROM_chick -> chick:TO_chick;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>We now have the attribute class information and record counts added, as well as automatic names for the individual relations.</p>
</div>
<div id="rejoin-a-database-to-a-data-frame" class="section level2">
<h2>Rejoin a database to a data frame</h2>
<p>We can reverse the process of turning a data frame into a database with the <code>rejoin</code> function. This may not be identical to <code>ChickWeight</code>, since the rows may have been rearranged. However, we can use the convenience function <code>df_equiv</code> to check for equivalence under row reordering:</p>
<pre class="r"><code>rejoined &lt;- rejoin(db)
summary(rejoined)
#&gt;      weight           Time           Chick     Diet   
#&gt;  Min.   : 35.0   Min.   : 0.00   13     : 12   1:220  
#&gt;  1st Qu.: 63.0   1st Qu.: 4.00   9      : 12   2:120  
#&gt;  Median :103.0   Median :10.00   20     : 12   3:120  
#&gt;  Mean   :121.8   Mean   :10.72   10     : 12   4:118  
#&gt;  3rd Qu.:163.8   3rd Qu.:16.00   17     : 12          
#&gt;  Max.   :373.0   Max.   :21.00   19     : 12          
#&gt;                                  (Other):506
identical(rejoined, ChickWeight)
#&gt; [1] FALSE
df_equiv(rejoined, ChickWeight)
#&gt; [1] FALSE</code></pre>
<p>When rejoined, the relation attributes will be in the original order. However, the record order might have changed.</p>
</div>
</div>
<div id="a-larger-example" class="section level1">
<h1>A larger example</h1>
<p>Included in the package is a 447-by-25 data frame called <code>nudge</code>:</p>
<pre class="r"><code>DiagrammeR::grViz(gv(nudge, name = &quot;nudge&quot;))</code></pre>
<div id="htmlwidget-7" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-7">{"x":{"diagram":"digraph nudge {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  nudge [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">nudge (447 rows)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT=\"FROM_es_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT=\"FROM_n_study\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT=\"FROM_n_comparison\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT=\"FROM_n_control\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD PORT=\"FROM_n_intervention\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT=\"FROM_mean_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT=\"FROM_sd_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT=\"FROM_mean_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT=\"FROM_sd_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT=\"FROM_cohens_d\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT=\"FROM_variance_d\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>This is the data set for a meta-analysis, looking at the effectiveness of “nudge” interventions. Measurements are taken within a three-layer hierarchy: publications contain studies, which contain effect size measurements. We expect this hierarchy to be apparent in the normalisation.</p>
<p>Getting full dependency information for this relation can take a long time, so here we search for a reduced set, not considering numeric or sample size attributes as determinants:</p>
<pre class="r"><code>nudge_deps &lt;- flatten(dfd(
  nudge,
  accuracy = 1,
  exclude = c(&quot;n_study&quot;, &quot;n_comparison&quot;, &quot;n_control&quot;, &quot;n_intervention&quot;),
  exclude_class = &quot;numeric&quot;
))
nudge_schema &lt;- cross_reference(normalise(nudge_deps, remove_avoidable = TRUE))
DiagrammeR::grViz(gv(nudge_schema))</code></pre>
<div id="htmlwidget-8" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-8">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  title [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">title<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT =\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD><\/TD><TD PORT =\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD><\/TD><TD PORT =\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD PORT =\"FROM_reference\"><\/TD><\/TR>\n    <\/TABLE>>];\n  es_id [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">es_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT =\"FROM_es_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT =\"FROM_study_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT =\"FROM_intervention_technique\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT =\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT =\"FROM_n_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD PORT =\"FROM_n_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT =\"FROM_binary_outcome\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT =\"FROM_mean_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT =\"FROM_sd_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT =\"FROM_mean_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT =\"FROM_sd_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT =\"FROM_cohens_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT =\"FROM_variance_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT =\"FROM_approximation\"><\/TD><\/TR>\n    <\/TABLE>>];\n  study_id [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">study_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT =\"FROM_study_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT =\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT =\"FROM_domain\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT =\"FROM_type_experiment\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT =\"FROM_population\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT =\"FROM_n_study\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT =\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  publication_id_domain [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">publication_id_domain<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT =\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT =\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD PORT =\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  publication_id_intervention_technique [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">publication_id_intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT =\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT =\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD PORT =\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  reference_binary_outcome [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference_binary_outcome<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT =\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT =\"FROM_binary_outcome\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT =\"FROM_title\"><\/TD><\/TR>\n    <\/TABLE>>];\n  reference [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT =\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT =\"FROM_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n  publication_id_location [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">publication_id_location<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT =\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT =\"FROM_location\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT =\"FROM_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n  publication_id_type_experiment [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">publication_id_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT =\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT =\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT =\"FROM_location\"><\/TD><\/TR>\n    <\/TABLE>>];\n  reference_type_experiment [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT =\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT =\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT =\"FROM_location\"><\/TD><\/TR>\n    <\/TABLE>>];\n  intervention_technique [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT =\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT =\"FROM_intervention_category\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  study_id:FROM_title -> title:TO_title;\n  reference_binary_outcome:FROM_title -> title:TO_title;\n  publication_id_location:FROM_publication_id -> title:TO_publication_id;\n  publication_id_location:FROM_year -> title:TO_year;\n  es_id:FROM_study_id -> study_id:TO_study_id;\n  title:FROM_reference -> reference:TO_reference;\n  publication_id_domain:FROM_reference -> reference:TO_reference;\n  publication_id_intervention_technique:FROM_reference -> reference:TO_reference;\n  reference_type_experiment:FROM_reference -> reference:TO_reference;\n  publication_id_type_experiment:FROM_publication_id -> publication_id_location:TO_publication_id;\n  publication_id_type_experiment:FROM_location -> publication_id_location:TO_location;\n  es_id:FROM_intervention_technique -> intervention_technique:TO_intervention_technique;\n  publication_id_intervention_technique:FROM_intervention_technique -> intervention_technique:TO_intervention_technique;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>We can see a relation, with many attributes, determined by the effect size ID number, <code>es_id</code>. This contains all of the numeric measurements, as expected in the relation for the lowest level in the hierarchy. As also expected, this has a foreign key reference to a relation for study-level information, determined by the study ID number, <code>study_id</code>.</p>
<p>However, the publication-level relation this refers to is not determined by the publication ID, <code>publication_id</code>, as we would expect. Instead, it is determined by the publication’s title: to use the ID, we would need to supplement it with the publication year. This suggests that some publication ID numbers have been erroneously assigned to several publications, which we can easily test:</p>
<pre class="r"><code>nudge_database &lt;- decompose(nudge, nudge_schema, &quot;nudge&quot;)
nudge_title_relation &lt;- nudge_database$relations$title$df
nudge_pid_duplicates &lt;- unique(nudge_title_relation$publication_id[
  duplicated(nudge_title_relation$publication_id)
])
knitr::kable(subset(nudge_title_relation, publication_id %in% nudge_pid_duplicates))</code></pre>
<table>
<colgroup>
<col width="3%" />
<col width="62%" />
<col width="12%" />
<col width="4%" />
<col width="17%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">title</th>
<th align="right">publication_id</th>
<th align="right">year</th>
<th align="left">reference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">44</td>
<td align="left">Enhanced active choice: A new method to motivate behavior change</td>
<td align="right">95</td>
<td align="right">2011</td>
<td align="left">Keller et al. (2011)</td>
</tr>
<tr class="even">
<td align="left">130</td>
<td align="left">Nudging product choices: The effect of position change on snack bar choice</td>
<td align="right">95</td>
<td align="right">2015</td>
<td align="left">Keller et al. (2015)</td>
</tr>
</tbody>
</table>
<p>This would also explain why the publication ID appears in several other relations, that look likely to be spurious.</p>
<p>Since the publication ID can’t be trusted, we could consider removing the attribute. Here, we’ll keep it, but remove all functional dependencies where it is in the determinant set, to get the same effect without re-running DFD:</p>
<pre class="r"><code>nudge_deps_filtered &lt;- nudge_deps
nudge_deps_filtered$dependencies &lt;- Filter(
  function(fd) !is.element(&quot;publication_id&quot;, fd[[1]]),
  nudge_deps_filtered$dependencies
)
nudge_schema_filtered &lt;- cross_reference(normalise(nudge_deps_filtered, remove_avoidable = TRUE))
DiagrammeR::grViz(gv(nudge_schema_filtered))</code></pre>
<div id="htmlwidget-9" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-9">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  title [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">title<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT =\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT =\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT =\"FROM_reference\"><\/TD><\/TR>\n    <\/TABLE>>];\n  es_id [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">es_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT =\"FROM_es_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT =\"FROM_study_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT =\"FROM_intervention_technique\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT =\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT =\"FROM_n_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD PORT =\"FROM_n_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT =\"FROM_binary_outcome\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT =\"FROM_mean_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT =\"FROM_sd_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT =\"FROM_mean_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT =\"FROM_sd_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT =\"FROM_cohens_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT =\"FROM_variance_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT =\"FROM_approximation\"><\/TD><\/TR>\n    <\/TABLE>>];\n  study_id [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">study_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT =\"FROM_study_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT =\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT =\"FROM_domain\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT =\"FROM_type_experiment\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT =\"FROM_population\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT =\"FROM_n_study\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT =\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  reference_domain [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference_domain<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT =\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT =\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT =\"FROM_title\"><\/TD><\/TR>\n    <\/TABLE>>];\n  reference_intervention_technique [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference_intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT =\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT =\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT =\"FROM_title\"><\/TD><\/TR>\n    <\/TABLE>>];\n  reference_binary_outcome [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference_binary_outcome<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT =\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT =\"FROM_binary_outcome\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT =\"FROM_title\"><\/TD><\/TR>\n    <\/TABLE>>];\n  reference [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT =\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT =\"FROM_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n  reference_type_experiment [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT =\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT =\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT =\"FROM_location\"><\/TD><\/TR>\n    <\/TABLE>>];\n  intervention_technique [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT =\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT =\"FROM_intervention_category\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  study_id:FROM_title -> title:TO_title;\n  reference_domain:FROM_title -> title:TO_title;\n  reference_intervention_technique:FROM_title -> title:TO_title;\n  reference_binary_outcome:FROM_title -> title:TO_title;\n  es_id:FROM_study_id -> study_id:TO_study_id;\n  title:FROM_reference -> reference:TO_reference;\n  reference_type_experiment:FROM_reference -> reference:TO_reference;\n  es_id:FROM_intervention_technique -> intervention_technique:TO_intervention_technique;\n  reference_intervention_technique:FROM_intervention_technique -> intervention_technique:TO_intervention_technique;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>This looks to be an improvement. However, we can still see some spurious relations involving <code>reference</code>. One of these combines it with <code>type_experiment</code> to determine <code>location</code>, a study-level attribute. The others combine it with another attribute to determine <code>title</code>. This is expected, since, in the publication-level relation, the title determines the reference, but not vice versa. This means that there are publications that share a reference:</p>
<pre class="r"><code>nudge_database_filtered &lt;- decompose(nudge, nudge_schema_filtered, &quot;nudge&quot;)
nudge_title_relation_filtered &lt;- nudge_database_filtered$relations$title$df
nudge_reference_duplicates &lt;- unique(nudge_title_relation_filtered$reference[
  duplicated(nudge_title_relation_filtered$reference)
])
knitr::kable(subset(nudge_title_relation_filtered, reference %in% nudge_reference_duplicates))</code></pre>
<table>
<colgroup>
<col width="3%" />
<col width="75%" />
<col width="11%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">title</th>
<th align="right">publication_id</th>
<th align="left">reference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">214</td>
<td align="left">Nudge vs superbugs: A behavioural economics trial to reduce the overprescribing of antibiotics</td>
<td align="right">18</td>
<td align="left">BETA (2018)</td>
</tr>
<tr class="even">
<td align="left">399</td>
<td align="left">Energy labels that make cents</td>
<td align="right">19</td>
<td align="left">BETA (2018)</td>
</tr>
</tbody>
</table>
<p>BETA is the Behavioural Economics Team of the Australian Government, so it’s not surprising that they’d have multiple publications/reports per year. Duplicate references is not necessarily an error, but would be awkward if the references were to be used.</p>
<p>While the reference is useful, the relations mentioned above are not, so we’ll also remove functional dependencies with the reference determining something apart from the year:</p>
<pre class="r"><code>nudge_deps_filtered2 &lt;- nudge_deps_filtered
nudge_deps_filtered2$dependencies &lt;- Filter(
  function(fd) !is.element(&quot;reference&quot;, fd[[1]]) || fd[[2]] == &quot;year&quot;,
  nudge_deps_filtered2$dependencies
)
nudge_schema_filtered2 &lt;- cross_reference(normalise(nudge_deps_filtered2, remove_avoidable = TRUE))
DiagrammeR::grViz(gv(nudge_schema_filtered2))</code></pre>
<div id="htmlwidget-10" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-10">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  title [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">title<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT =\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT =\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT =\"FROM_reference\"><\/TD><\/TR>\n    <\/TABLE>>];\n  es_id [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">es_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT =\"FROM_es_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT =\"FROM_study_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT =\"FROM_intervention_technique\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT =\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT =\"FROM_n_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD PORT =\"FROM_n_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT =\"FROM_binary_outcome\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT =\"FROM_mean_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT =\"FROM_sd_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT =\"FROM_mean_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT =\"FROM_sd_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT =\"FROM_cohens_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT =\"FROM_variance_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT =\"FROM_approximation\"><\/TD><\/TR>\n    <\/TABLE>>];\n  study_id [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">study_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT =\"FROM_study_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT =\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT =\"FROM_domain\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT =\"FROM_type_experiment\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT =\"FROM_population\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT =\"FROM_n_study\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT =\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  reference [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT =\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT =\"FROM_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n  title_type_experiment [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">title_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT =\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT =\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT =\"FROM_location\"><\/TD><\/TR>\n    <\/TABLE>>];\n  intervention_technique [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT =\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT =\"FROM_intervention_category\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  title_type_experiment:FROM_title -> title:TO_title;\n  es_id:FROM_study_id -> study_id:TO_study_id;\n  title:FROM_reference -> reference:TO_reference;\n  study_id:FROM_title -> title_type_experiment:TO_title;\n  study_id:FROM_type_experiment -> title_type_experiment:TO_type_experiment;\n  es_id:FROM_intervention_technique -> intervention_technique:TO_intervention_technique;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>We now, finally, have the study location in a non-spurious relation. Interestingly, removing dependencies has revealed extra information about study locations, via the new <code>title_type_experiment</code> relation: studies of the same experiment type in a publication always have the same location. Looking at the resulting database shows that this removes many entries of what would be redundant location information if kept in the study relation:</p>
<pre class="r"><code>nudge_database_filtered2 &lt;- decompose(nudge, nudge_schema_filtered2, &quot;nudge&quot;)
DiagrammeR::grViz(gv(nudge_database_filtered2))</code></pre>
<div id="htmlwidget-11" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-11">{"x":{"diagram":"digraph nudge {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  title [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">title (213 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_title\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD><\/TD><TD PORT=\"FROM_publication_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD PORT=\"FROM_reference\">character<\/TD><\/TR>\n    <\/TABLE>>];\n  es_id [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">es_id (447 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_es_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD><\/TD><TD PORT=\"FROM_study_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD><\/TD><TD PORT=\"FROM_n_comparison\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD><\/TD><TD PORT=\"FROM_n_control\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD><\/TD><TD PORT=\"FROM_n_intervention\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD><\/TD><TD PORT=\"FROM_binary_outcome\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD><\/TD><TD PORT=\"FROM_mean_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD><\/TD><TD PORT=\"FROM_sd_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD><\/TD><TD PORT=\"FROM_mean_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD><\/TD><TD PORT=\"FROM_sd_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD><\/TD><TD PORT=\"FROM_cohens_d\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD><\/TD><TD PORT=\"FROM_variance_d\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD><\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  study_id [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">study_id (334 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_study_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD><\/TD><TD PORT=\"FROM_title\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD><\/TD><TD PORT=\"FROM_population\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD><\/TD><TD PORT=\"FROM_n_study\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  reference [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">reference (212 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_reference\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <\/TABLE>>];\n  title_type_experiment [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">title_type_experiment (231 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_title\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD><\/TD><TD PORT=\"FROM_location\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  intervention_technique [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">intervention_technique (9 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD><\/TD><TD PORT=\"FROM_intervention_category\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n\n  title_type_experiment:FROM_title -> title:TO_title;\n  es_id:FROM_study_id -> study_id:TO_study_id;\n  title:FROM_reference -> reference:TO_reference;\n  study_id:FROM_title -> title_type_experiment:TO_title;\n  study_id:FROM_type_experiment -> title_type_experiment:TO_type_experiment;\n  es_id:FROM_intervention_technique -> intervention_technique:TO_intervention_technique;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>While this is not a dependency we could expect to hold if more data was collected, it’s a reasonable dependency for the given data set, which won’t be added to.</p>
<p>(As far as I’m aware, the publication ID error mentioned above would not have affected the meta-analysis results.)</p>
</div>
<div id="other-features" class="section level1">
<h1>Other features</h1>
<div id="approximate-dependencies-and-database-reduction" class="section level2">
<h2>Approximate dependencies and database reduction</h2>
<p>Larger datasets can often have entry errors, without an easy way to remove or deal with them. For this reason, we might be interested in “approximate” functional dependencies, which hold after removing a bounded amount of violating records.</p>
<p>Suppose that we normalise <code>nudge</code> again, without any manual dependency removal, but allow approximate dependencies, that hold in only <code>0.99</code> of the records. Since <code>nudge</code> has 447, the dependencies must hold over at least 443 records.</p>
<pre class="r"><code>nudge_approx_database &lt;- autodb(
  nudge,
  accuracy = 0.99,
  exclude = c(&quot;n_study&quot;, &quot;n_comparison&quot;, &quot;n_control&quot;, &quot;n_intervention&quot;),
  exclude_class = &quot;numeric&quot;
)
DiagrammeR::grViz(gv(nudge_approx_database))</code></pre>
<div id="htmlwidget-12" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-12">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  publication_id [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"5\">publication_id (215 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_publication_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_reference\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD><\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_title\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD><\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD><\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_population\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  es_id [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">es_id (447 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_es_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD><\/TD><TD PORT=\"FROM_study_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD><\/TD><TD PORT=\"FROM_n_comparison\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD><\/TD><TD PORT=\"FROM_n_control\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD><\/TD><TD PORT=\"FROM_n_intervention\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD><\/TD><TD PORT=\"FROM_mean_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD><\/TD><TD PORT=\"FROM_sd_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD><\/TD><TD PORT=\"FROM_mean_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD><\/TD><TD PORT=\"FROM_sd_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD><\/TD><TD PORT=\"FROM_cohens_d\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD><\/TD><TD PORT=\"FROM_variance_d\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n  study_id [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">study_id (334 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_study_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD><\/TD><TD PORT=\"FROM_publication_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD><\/TD><TD PORT=\"FROM_n_study\">integer<\/TD><\/TR>\n    <\/TABLE>>];\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation (259 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_location\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_binary_outcome\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD><\/TD><TD PORT=\"FROM_publication_id\">integer<\/TD><\/TR>\n    <\/TABLE>>];\n  publication_id_type_experiment [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">publication_id_type_experiment (237 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_publication_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD BGCOLOR=\"black\"><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_reference\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_location\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_binary_outcome\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  intervention_technique [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">intervention_technique (9 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD><\/TD><TD PORT=\"FROM_intervention_category\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  year_domain_intervention_technique_type_experiment_approximation [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_domain_intervention_technique_type_experiment_approximation (239 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD><\/TD><TD PORT=\"FROM_population\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  year_location_domain_intervention_technique_approximation [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_location_domain_intervention_technique_approximation (225 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_location\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD><\/TD><TD PORT=\"FROM_population\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  year_location_domain_intervention_category_binary_outcome_wansink [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_location_domain_intervention_category_binary_outcome_wansink (209 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_location\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_category\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_binary_outcome\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD><\/TD><TD PORT=\"FROM_population\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  year_domain_intervention_technique_binary_outcome [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_domain_intervention_technique_binary_outcome (217 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_binary_outcome\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD><\/TD><TD PORT=\"FROM_population\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  year_location_domain_intervention_category_type_experiment [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_location_domain_intervention_category_type_experiment (223 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_location\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_category\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD><\/TD><TD PORT=\"FROM_population\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  publication_id_domain [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">publication_id_domain (223 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_publication_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD><\/TD><TD PORT=\"FROM_binary_outcome\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  year_domain_intervention_category_type_experiment [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_domain_intervention_category_type_experiment (205 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_category\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  year_domain_intervention_technique [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_domain_intervention_technique (190 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  year_location_domain_approximation [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_location_domain_approximation (158 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_location\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  year_domain_intervention_category_population_approximation [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_domain_intervention_category_population_approximation (180 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_category\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_population\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  year_intervention_technique_binary_outcome_approximation [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_intervention_technique_binary_outcome_approximation (165 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_binary_outcome\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  year_domain_intervention_category_binary_outcome_approximation [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_domain_intervention_category_binary_outcome_approximation (199 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_category\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_binary_outcome\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  year_domain_type_experiment_approximation [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_domain_type_experiment_approximation (185 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  year_location_domain_type_experiment [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_location_domain_type_experiment (194 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_location\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  year_intervention_technique_type_experiment_approximation [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_intervention_technique_type_experiment_approximation (200 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  year_location_intervention_technique_population_approximation [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">year_location_intervention_technique_population_approximation (170 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_location\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_population\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n\n  publication_id_type_experiment:FROM_publication_id -> publication_id:TO_publication_id;\n  publication_id_domain:FROM_publication_id -> publication_id:TO_publication_id;\n  es_id:FROM_study_id -> study_id:TO_study_id;\n  study_id:FROM_publication_id -> publication_id_type_experiment:TO_publication_id;\n  study_id:FROM_type_experiment -> publication_id_type_experiment:TO_type_experiment;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_publication_id -> publication_id_type_experiment:TO_publication_id;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_type_experiment -> publication_id_type_experiment:TO_type_experiment;\n  es_id:FROM_intervention_technique -> intervention_technique:TO_intervention_technique;\n  year_domain_intervention_technique:FROM_intervention_technique -> intervention_technique:TO_intervention_technique;\n  year_intervention_technique_binary_outcome_approximation:FROM_intervention_technique -> intervention_technique:TO_intervention_technique;\n  year_intervention_technique_type_experiment_approximation:FROM_intervention_technique -> intervention_technique:TO_intervention_technique;\n  year_location_intervention_technique_population_approximation:FROM_intervention_technique -> intervention_technique:TO_intervention_technique;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_year -> year_domain_intervention_technique_type_experiment_approximation:TO_year;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_domain -> year_domain_intervention_technique_type_experiment_approximation:TO_domain;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_intervention_technique -> year_domain_intervention_technique_type_experiment_approximation:TO_intervention_technique;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_type_experiment -> year_domain_intervention_technique_type_experiment_approximation:TO_type_experiment;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_approximation -> year_domain_intervention_technique_type_experiment_approximation:TO_approximation;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_year -> year_location_domain_intervention_technique_approximation:TO_year;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_location -> year_location_domain_intervention_technique_approximation:TO_location;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_domain -> year_location_domain_intervention_technique_approximation:TO_domain;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_intervention_technique -> year_location_domain_intervention_technique_approximation:TO_intervention_technique;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_approximation -> year_location_domain_intervention_technique_approximation:TO_approximation;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_year -> year_domain_intervention_technique_binary_outcome:TO_year;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_domain -> year_domain_intervention_technique_binary_outcome:TO_domain;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_intervention_technique -> year_domain_intervention_technique_binary_outcome:TO_intervention_technique;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_binary_outcome -> year_domain_intervention_technique_binary_outcome:TO_binary_outcome;\n  study_id:FROM_publication_id -> publication_id_domain:TO_publication_id;\n  study_id:FROM_domain -> publication_id_domain:TO_domain;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_publication_id -> publication_id_domain:TO_publication_id;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_domain -> publication_id_domain:TO_domain;\n  year_location_domain_intervention_category_type_experiment:FROM_year -> year_domain_intervention_category_type_experiment:TO_year;\n  year_location_domain_intervention_category_type_experiment:FROM_domain -> year_domain_intervention_category_type_experiment:TO_domain;\n  year_location_domain_intervention_category_type_experiment:FROM_intervention_category -> year_domain_intervention_category_type_experiment:TO_intervention_category;\n  year_location_domain_intervention_category_type_experiment:FROM_type_experiment -> year_domain_intervention_category_type_experiment:TO_type_experiment;\n  year_domain_intervention_technique_type_experiment_approximation:FROM_year -> year_domain_intervention_technique:TO_year;\n  year_domain_intervention_technique_type_experiment_approximation:FROM_domain -> year_domain_intervention_technique:TO_domain;\n  year_domain_intervention_technique_type_experiment_approximation:FROM_intervention_technique -> year_domain_intervention_technique:TO_intervention_technique;\n  year_location_domain_intervention_technique_approximation:FROM_year -> year_domain_intervention_technique:TO_year;\n  year_location_domain_intervention_technique_approximation:FROM_domain -> year_domain_intervention_technique:TO_domain;\n  year_location_domain_intervention_technique_approximation:FROM_intervention_technique -> year_domain_intervention_technique:TO_intervention_technique;\n  year_domain_intervention_technique_binary_outcome:FROM_year -> year_domain_intervention_technique:TO_year;\n  year_domain_intervention_technique_binary_outcome:FROM_domain -> year_domain_intervention_technique:TO_domain;\n  year_domain_intervention_technique_binary_outcome:FROM_intervention_technique -> year_domain_intervention_technique:TO_intervention_technique;\n  year_location_domain_intervention_technique_approximation:FROM_year -> year_location_domain_approximation:TO_year;\n  year_location_domain_intervention_technique_approximation:FROM_location -> year_location_domain_approximation:TO_location;\n  year_location_domain_intervention_technique_approximation:FROM_domain -> year_location_domain_approximation:TO_domain;\n  year_location_domain_intervention_technique_approximation:FROM_approximation -> year_location_domain_approximation:TO_approximation;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_year -> year_intervention_technique_binary_outcome_approximation:TO_year;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_intervention_technique -> year_intervention_technique_binary_outcome_approximation:TO_intervention_technique;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_binary_outcome -> year_intervention_technique_binary_outcome_approximation:TO_binary_outcome;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_approximation -> year_intervention_technique_binary_outcome_approximation:TO_approximation;\n  year_domain_intervention_technique_type_experiment_approximation:FROM_year -> year_domain_type_experiment_approximation:TO_year;\n  year_domain_intervention_technique_type_experiment_approximation:FROM_domain -> year_domain_type_experiment_approximation:TO_domain;\n  year_domain_intervention_technique_type_experiment_approximation:FROM_type_experiment -> year_domain_type_experiment_approximation:TO_type_experiment;\n  year_domain_intervention_technique_type_experiment_approximation:FROM_approximation -> year_domain_type_experiment_approximation:TO_approximation;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_year -> year_location_domain_type_experiment:TO_year;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_location -> year_location_domain_type_experiment:TO_location;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_domain -> year_location_domain_type_experiment:TO_domain;\n  year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation:FROM_type_experiment -> year_location_domain_type_experiment:TO_type_experiment;\n  year_location_domain_intervention_category_type_experiment:FROM_year -> year_location_domain_type_experiment:TO_year;\n  year_location_domain_intervention_category_type_experiment:FROM_location -> year_location_domain_type_experiment:TO_location;\n  year_location_domain_intervention_category_type_experiment:FROM_domain -> year_location_domain_type_experiment:TO_domain;\n  year_location_domain_intervention_category_type_experiment:FROM_type_experiment -> year_location_domain_type_experiment:TO_type_experiment;\n  year_domain_intervention_technique_type_experiment_approximation:FROM_year -> year_intervention_technique_type_experiment_approximation:TO_year;\n  year_domain_intervention_technique_type_experiment_approximation:FROM_intervention_technique -> year_intervention_technique_type_experiment_approximation:TO_intervention_technique;\n  year_domain_intervention_technique_type_experiment_approximation:FROM_type_experiment -> year_intervention_technique_type_experiment_approximation:TO_type_experiment;\n  year_domain_intervention_technique_type_experiment_approximation:FROM_approximation -> year_intervention_technique_type_experiment_approximation:TO_approximation;\n  year_location_domain_intervention_technique_approximation:FROM_year -> year_location_intervention_technique_population_approximation:TO_year;\n  year_location_domain_intervention_technique_approximation:FROM_location -> year_location_intervention_technique_population_approximation:TO_location;\n  year_location_domain_intervention_technique_approximation:FROM_intervention_technique -> year_location_intervention_technique_population_approximation:TO_intervention_technique;\n  year_location_domain_intervention_technique_approximation:FROM_population -> year_location_intervention_technique_population_approximation:TO_population;\n  year_location_domain_intervention_technique_approximation:FROM_approximation -> year_location_intervention_technique_population_approximation:TO_approximation;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>This is a little overwhelming, so we’ll use a utility function called <code>reduce</code>. This finds the relation with the most records, which can be considered as the “main” relation, and removes any relations not linked to it by foreign key references. Reducing the approximate database gives us this set of relations:</p>
<pre class="r"><code>DiagrammeR::grViz(gv(reduce(nudge_approx_database)))</code></pre>
<div id="htmlwidget-13" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-13">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  publication_id [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"5\">publication_id (215 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_publication_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_reference\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD><\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_title\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD><\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD><\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_population\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  es_id [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">es_id (447 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_es_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD><\/TD><TD PORT=\"FROM_study_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD><\/TD><TD PORT=\"FROM_n_comparison\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD><\/TD><TD PORT=\"FROM_n_control\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD><\/TD><TD PORT=\"FROM_n_intervention\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD><\/TD><TD PORT=\"FROM_mean_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD><\/TD><TD PORT=\"FROM_sd_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD><\/TD><TD PORT=\"FROM_mean_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD><\/TD><TD PORT=\"FROM_sd_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD><\/TD><TD PORT=\"FROM_cohens_d\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD><\/TD><TD PORT=\"FROM_variance_d\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n  study_id [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">study_id (334 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_study_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD><\/TD><TD PORT=\"FROM_publication_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD><\/TD><TD PORT=\"FROM_n_study\">integer<\/TD><\/TR>\n    <\/TABLE>>];\n  publication_id_type_experiment [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">publication_id_type_experiment (237 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_publication_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD BGCOLOR=\"black\"><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_reference\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_location\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_binary_outcome\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  intervention_technique [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">intervention_technique (9 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD><\/TD><TD PORT=\"FROM_intervention_category\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  publication_id_domain [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">publication_id_domain (223 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_publication_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD><\/TD><TD PORT=\"FROM_binary_outcome\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n\n  publication_id_type_experiment:FROM_publication_id -> publication_id:TO_publication_id;\n  publication_id_domain:FROM_publication_id -> publication_id:TO_publication_id;\n  es_id:FROM_study_id -> study_id:TO_study_id;\n  study_id:FROM_publication_id -> publication_id_type_experiment:TO_publication_id;\n  study_id:FROM_type_experiment -> publication_id_type_experiment:TO_type_experiment;\n  es_id:FROM_intervention_technique -> intervention_technique:TO_intervention_technique;\n  study_id:FROM_publication_id -> publication_id_domain:TO_publication_id;\n  study_id:FROM_domain -> publication_id_domain:TO_domain;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>Questionable intermediate relations aside, we can see that there is now a publication-level relation with the publication ID as a key, since it determines the publication attributes once we remove one of the duplicate records we discovered before.</p>
<p><code>reduce</code> needs to be used with caution: while the relations it removes are often spurious, it’s possible to find databases where relations not linked to the main relation by foreign key references are required to rejoin to the original data frame, so reduction can remove necessary relations. Its intent is mostly to make glancing at database plots more manageable.</p>
</div>
<div id="avoidable-attributes" class="section level2">
<h2>Avoidable attributes</h2>
<p>The next normal form after third normal form (3NF) is Boyes-Codd normal form (BCNF). It represents an issue for automatic normalisation, since not all relations can be put into BCNF. Even worse, determining whether a database schema in 3NF is in BCNF is intractable.</p>
<p>Instead, the package includes an option to convert to enhanced third normal form, also known as LTK form. This enhancement is tangential to BCNF, and can also be used to enhance schemas in BCNF.</p>
<p>In brief, the standard normal forms only put constraints on the attributes present in the relations one relation at a time. The enhancement is a constraint on the attributes present in a relation, while considering their presence in other relations. If a attribute in a relation can be removed, and still be determined from that relation by joining it to others, then the attribute is “avoidable”, and can be removed. If the attribute is in any of the relation’s keys, they’ll be replaced by keys that use the attributes not being removed. This removes attributes from relations without removing any information from the database as a whole.</p>
<p>For example, we can take this simple example from Chapter 6 of The Theory of Relational Databases, by David Maier:</p>
<pre class="r"><code>avoid_deps &lt;- list(
  dependencies = list(
    list(&quot;A&quot;, &quot;B&quot;),
    list(&quot;B&quot;, &quot;A&quot;),
    list(c(&quot;A&quot;, &quot;C&quot;), &quot;D&quot;),
    list(c(&quot;A&quot;, &quot;C&quot;), &quot;E&quot;),
    list(c(&quot;B&quot;, &quot;D&quot;), &quot;C&quot;)
  ),
  attrs = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;)
)
avoid_schema &lt;- cross_reference(normalise(avoid_deps))
DiagrammeR::grViz(gv(avoid_schema))</code></pre>
<div id="htmlwidget-14" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-14">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  a [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">A<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">A<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT =\"FROM_a\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">B<\/TD><TD><\/TD><TD PORT =\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  a_c [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">A_C<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">A<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT =\"FROM_a\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">C<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT =\"FROM_c\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">B<\/TD><TD><\/TD><TD PORT =\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">D<\/TD><TD><\/TD><TD PORT =\"FROM_d\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_e\">E<\/TD><TD><\/TD><TD PORT =\"FROM_e\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  a_c:FROM_a -> a:TO_a;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>Attributes <code>A</code> and <code>B</code> are equivalent, since relation <code>A</code> has them both as a key. In other words, relation <code>A</code> is a simple lookup relation. Because of this, we could remove <code>B</code> from relation <code>A_C</code>, and replace the key <code>B, D</code> with <code>A, D</code>, which is equivalent when accounting from the lookup relation <code>A</code>.</p>
<p>We can have this removal of avoidable attributes done automatically, using the <code>remove_avoidable</code> flag for <code>normalise</code>:</p>
<pre class="r"><code>avoid_schema_removed &lt;- cross_reference(normalise(
  avoid_deps,
  remove_avoidable = TRUE
))
DiagrammeR::grViz(gv(avoid_schema_removed))</code></pre>
<div id="htmlwidget-15" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-15">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  a [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">A<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">A<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT =\"FROM_a\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">B<\/TD><TD><\/TD><TD PORT =\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  a_c [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">A_C<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">A<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT =\"FROM_a\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">C<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT =\"FROM_c\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">D<\/TD><TD><\/TD><TD PORT =\"FROM_d\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_e\">E<\/TD><TD><\/TD><TD PORT =\"FROM_e\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  a_c:FROM_a -> a:TO_a;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>This schema is now in LTK form, with no remaining avoidable attributes. We could have also removed <code>A</code> from relation <code>A_C</code> instead of <code>B</code>, so this process may not have a unique result. The package’s implementation prefers to remove attributes that appear later in the original relation.</p>
</div>
</div>
<div id="planned-extensions" class="section level1">
<h1>Planned extensions</h1>
<div id="class-information-in-schemas" class="section level2">
<h2>Class information in schemas</h2>
<p>As shown in the plots above, database schemas don’t contain information about the attribute classes: this is only added on database creation. This would potentially be useful if the original data.frame is large, and creating the database would take a long time.</p>
</div>
<div id="pretty-printing-for-functional-dependencies" class="section level2">
<h2>Pretty printing for functional dependencies</h2>
<p>Lists of functional dependencies – both the grouped ones returned by <code>dfd</code>, and the flattened ones given to <code>normalise</code> – use the default printing for lists. They should have a prettier printing operation, making use of the usual <code>A -&gt; B</code> notation for functional dependencies.</p>
</div>
<div id="better-consistency-checks" class="section level2">
<h2>Better consistency checks</h2>
<p>There are obvious consistency checks that are missing. One example is when the relation decomposed with a schema is different to the one originally used to create the schema: if the new relation doesn’t satisfy the schema’s functional dependencies, the result will have relations with inconsistent information, which may or may not become apparent when the database is rejoined into a data frame.</p>
</div>
<div id="handling-of-duplicate-records" class="section level2">
<h2>Handling of duplicate records</h2>
<p>It’s expected that an R user might pass a data frame into the package that has duplicate records. At the moment, these are kept when searching for dependencies. This can affect results for approximate dependencies, due to affecting the record counts. However, they will be removed when the data frame is decomposed into a database. At the moment, I’m not certain on whether they are best handled by removing them, or by simply returning an error if there are duplicate records.</p>
</div>
<div id="missing-values" class="section level2">
<h2>Missing values</h2>
<p>In relational databases, we commonly want to avoid the presence of missing values. For example, take the following data frame:</p>
<pre class="r"><code>df_nas &lt;- data.frame(
  patient_id = c(1L, 2L, 3L, 4L),
  trial_entry_date = as.Date(c(&quot;2022/05/02&quot;, &quot;2022/06/06&quot;, &quot;2022/04/01&quot;, &quot;2022/03/19&quot;)),
  death_date = as.Date(c(NA, NA, &quot;2022/10/07&quot;, NA))
)
df_nas
#&gt;   patient_id trial_entry_date death_date
#&gt; 1          1       2022-05-02       &lt;NA&gt;
#&gt; 2          2       2022-06-06       &lt;NA&gt;
#&gt; 3          3       2022-04-01 2022-10-07
#&gt; 4          4       2022-03-19       &lt;NA&gt;</code></pre>
<p>The package currently treats <code>NA</code> as just another value, with no special treatment for normalisation or rejoining, resulting in no splitting of the above data frame:</p>
<pre class="r"><code>DiagrammeR::grViz(gv(autodb(df_nas, 1)))</code></pre>
<div id="htmlwidget-16" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-16">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  patient_id [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">patient_id (4 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_patient_id\">patient_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_patient_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_trial_entry_date\">trial_entry_date<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_trial_entry_date\">Date<\/TD><\/TR>\n    <TR><TD PORT=\"TO_death_date\">death_date<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_death_date\">Date<\/TD><\/TR>\n    <\/TABLE>>];\n\n\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>In this case, a missing death date represents no death, and we would prefer to move death information to a separate relation, containing only patients with a death date, in this case patient 3:</p>
<pre class="r"><code>ideal_db &lt;- structure(
  list(
    name = &quot;patients&quot;,
    relations = list(
      patient = list(
        df = data.frame(
          patient_id = c(1L, 2L, 3L, 4L),
          trial_entry_date = as.Date(c(&quot;2022/05/02&quot;, &quot;2022/06/06&quot;, &quot;2022/04/01&quot;, &quot;2022/03/19&quot;))
        ),
        keys = list(&quot;patient_id&quot;),
        parents = character()
      ),
      death = list(
        df = data.frame(
          patient_id = 3L,
          death_date = as.Date(&quot;2022/10/07&quot;)
        ),
        keys = list(&quot;patient_id&quot;),
        parents = &quot;patient&quot;
      )
    ),
    relationships = list(c(&quot;death&quot;, &quot;patient_id&quot;, &quot;patient&quot;, &quot;patient_id&quot;)),
    attributes = c(&quot;patient_id&quot;, &quot;trial_entry_date&quot;, &quot;death_date&quot;)
  ),
  class = c(&quot;database&quot;, &quot;list&quot;)
)
DiagrammeR::grViz(gv(ideal_db))</code></pre>
<div id="htmlwidget-17" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-17">{"x":{"diagram":"digraph patients {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  patient [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">patient (4 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_patient_id\">patient_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_patient_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_trial_entry_date\">trial_entry_date<\/TD><TD><\/TD><TD PORT=\"FROM_trial_entry_date\">Date<\/TD><\/TR>\n    <\/TABLE>>];\n  death [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">death (1 record)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_patient_id\">patient_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_patient_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_death_date\">death_date<\/TD><TD><\/TD><TD PORT=\"FROM_death_date\">Date<\/TD><\/TR>\n    <\/TABLE>>];\n\n  death:FROM_patient_id -> patient:TO_patient_id;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>Handling cases like this requires automatically detecting, and normalising, nullable functional dependencies, which account for the ambiguity of missing values.</p>
</div>
</div>
